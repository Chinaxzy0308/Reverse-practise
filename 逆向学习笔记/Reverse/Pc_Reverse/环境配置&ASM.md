# 环境配置

- 编译命令
  ml /c asm 文件.asm 
  ink asm文件.obj

- 编译＋调试 脚本

  ml /c %1.asm
  link %1.asm
  debug %1.exe

# ASM文件

- 入口

  - 入口点指定使用关键字end,后面跟上标号名（end 后面的标号就是程序入口)
  - 入口点可以写在任意的段外面，但一般写在文件末尾

- 段

  - 一个程序必须有一个段
  - 一个程序可以定义多个段
  - 段不能嵌套
  - 段会被根据大小跟配内存，以16个字节对齐，不够的补零
  - 段可以重名，重名的段会被编译到同一块内存

- 注释

  - 只有行注释，没有段注释。
  - 用分号来表示注释

- 常量：**一般都定义在数据段**

  - 整数 

    - 整数可以支持多个进制

    - 数值必须以数字开头，如果非数字，前面必须加0

    - 负数前面可以加减号（-）

    - | 关键字 | 说明     | 示例                       |
      | ------ | -------- | :------------------------- |
      | D      | 十进制   | mov ax,1234 or mov ax,1234 |
      | B      | 二进制   | mov ax,1011b               |
      | O      | 八进制   | mov ax, 76o                |
      | H      | 十六进制 | mov ax,76h or mox ax,0abh  |
    
  - 字符
  
    - 字符可以用单引号（’）或 双引号（“”）
      mov byte ptr [bx],'$'
  
- 变量

  - 整数

    - 整数可以支持多个类型

    - 整数可以有多个初值，未初始化的值用问好（？）表示

    - 变量一般定义在一个独立的段中

    - 语法：|变量名|类型|初始值|

    - | 关键字 | 意义   |
      | ------ | ------ |
      | db     | 字节   |
      | dw     | 字     |
      | dd     | 双字   |
      | dq     | 八字节 |
      | dt     | 十字节 |

    - ##### tips:汇编器会生成一个 **符号表**，它将每个变量（包括标签、函数名、常量等）的名字与其地址或偏移量相关联

    - ```asm
      有时候我们说明了：assume ds:date_seg
      但是ds的值仍然不对，这是因为assume只是告诉编译器在生成代码时假定ds只想data_seg段，但不会自动将ds寄存器设置为data_seg段的实际地址，这时需要显示地初始化ds：
      mov ax,data_seg
      mov ds,ax
  - 字符串
  
    - 字符串一般用单引号（‘）或者双引号（“”）
    - 字符串一般以美元符$结尾
    - `g_sz db "hello world$"`
  
  - 数组
  
    - 格式：名字 类型 值1，值2，值3
  
    ​			       名字 类型 数量 dup(初值)，数量 dup（初值)，值
  
    - dup()一般用于初始化一段空间，用这段空间的大小来填充
  
  - 属性
  
    - masm提供很多伪指令，可以获取变量的小大和地址，称之为变量的属性
  
    | 关键字 | 意义                     |
    | ------ | ------------------------ |
    | seg    | 取段基址                 |
    | offset | 取段偏移                 |
    | type   | 取元素类型大小           |
    | length | 取元素个数               |
    | size   | 取数据大小（length*type) |
  
  - 调用dos功能号
  
    - 功能号：
  
      - dos系统提供的api,通过**21**号来控制中断来调用
      - 每个功能都有一个编号，通过AH指定功能号
      - 每个功能号的参数查看手册
  
      ![image-20250402114847426](C:\Users\33712\AppData\Roaming\Typora\typora-user-images\image-20250402114847426.png)
  
    - 中断
  
      - 中断是由cpu提供的流程跳转指令，类似函数调用
  
      - 在00:00位置存储着一个双子数组，大小为256，称作中断向量表
  
      - 数组元素为逻辑地址：段偏移：段基址
  
      - int n的意思是从第n个元素获取地址，然后执行跳转
  
        ![image-20250402115430768](C:\Users\33712\AppData\Roaming\Typora\typora-user-images\image-20250402115430768.png)
    
  - 堆栈
  
    - stack关键字让程序在加载的时候指定ss，bp和sp
    - 使用数组为栈设置大小